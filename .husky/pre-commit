#!/bin/sh

# Pre-commit: pnpm enforcement, auto-tag files, typecheck, format, pattern detection
# Series-A Standard: All checks required for commit success

# 1. Enforce pnpm-only policy (prevent npm accidents)
node scripts/enforce-pnpm.js || exit 1

# 2. Auto-tag files with metadata (track changes)
node scripts/tag-files.mjs || exit 1

# 3. TypeScript type checking (catch TS1128, TS1005, TS1472, etc)
pnpm -w typecheck || exit 1

# 4. Code formatting (fix parens, braces, whitespace)
pnpm -w format || exit 1

# 5. ESLint: catches unused imports, syntax issues
pnpm -w lint || exit 1

# 6. Error pattern detection (recurring issues >3 times)
node scripts/detect-error-patterns.js || exit 1

echo "[husky] Pre-commit checks completed âœ…"
